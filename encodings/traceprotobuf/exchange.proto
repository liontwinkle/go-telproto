syntax = "proto3";

package traceprotobuf;

import "trace.proto";

option java_multiple_files = true;
option java_package = "io.opencensus.proto.trace.v1";
option java_outer_classname = "TraceProto";

option ruby_package = "OpenCensus.Proto.Trace.V1";

message HelloRequest {
  int32 client_ver = 1;
}

enum Capabilities {
    SKIP = 0;
    ZLIB_COMPRESSION = 1; // bit 0 of capabilities
    LZ4_COMPRESSION = 2;  // bit 1 of capabilities
}

message HelloResponse {
  int32 server_ver = 1;
  uint32 capabilities = 2; // bitwise OR of Capabilities
}

// A request from client to server containing telemetry data to export.
message ExportRequest {
  // Unique sequential ID generated by the client.
  uint64 id = 1;

  // Telemetry data.
  repeated Span spans = 2;
  repeated Metric metrics = 3;
}

// A response to ExportRequest.
message ExportResponse {
  // ID of a response that the server acknowledges.
  uint64 id = 1;
  enum ResultCode {
    // Telemetry data is successfully processed by the server.
    Success = 0;
    
    // processing of telemetry data failed. The client MUST NOT retry 
    // sending the same telemetry data. The telemetry data MUST be dropped. 
    // This for example can happen when the request contains bad data and 
    // cannot be deserialized or otherwise processed by the server.
    FailedNoneRetryable = 1;
    
    // Processing of telemetry data failed. The client SHOULD record the 
    // error and MAY retry exporting the same data after some time. This 
    // for example can happen when the server is overloaded.
    FailedRetryable = 2;
  }
  ResultCode result_code = 2;
}

enum CompressionMethod {
    NONE = 0;
    LZ4 = 1;
    ZLIB = 2;
}

// RequestHeader is used by transports that unlike gRPC don't have built-in request
// compression such as WebSocket. Request body typically follows the header.
message RequestHeader {
  // Compression method used for body.
  CompressionMethod compression = 1;
  // Compression level as defined by the compression method.
  int32 compression_level = 2;
}

// RequestBody is used by transports that unlike gRPC don't have built-in message type
// multiplexing such as WebSocket.
message RequestBody {
  oneof body {
    HelloRequest hello = 1;
    ExportRequest export = 2;
  }
}

// Response is used by transports that unlike gRPC don't have built-in message type
// multiplexing such as WebSocket.
message Response {
    oneof body {
        HelloResponse hello = 1;
        ExportResponse export = 2;
    }
}